<!--
The valueset_modal macro builds modal windows that allow the user to search lists
of valuesets obtained from the senlib database. The valueset-modal.js script populates
a list in the modal with valueset information.
-->
{% macro valueset_modal(modal_id, modal_label, modal_list_id) %}
<div class="modal fade"
     id="{{ modal_id }}"
     tabindex="-1"
     aria-labelledby="{{ modal_id }}Label"
     role="dialog"
     aria-modal="true"
     inert>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ modal_id }}Label">Select {{ modal_label }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="{{ modal_list_id }}" class="list-group"></div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var modalEl = document.getElementById('{{ modal_id }}');
    var openerButton = null;

    if (!modalEl) return;

    // Detect when modal is shown
    modalEl.addEventListener('show.bs.modal', function(e) {
        // Save the currently focused element as opener
        openerButton = document.activeElement;
        modalEl.removeAttribute('inert');
    });

    // Detect when modal is hidden
    modalEl.addEventListener('hidden.bs.modal', function(e) {
        modalEl.setAttribute('inert', '');
        // Restore focus to opener button if possible
        if (openerButton && typeof openerButton.focus === 'function') {
            openerButton.focus();
        } else {
            // As fallback, blur any active element
            document.activeElement.blur();
        }
        openerButton = null;
    });
});
</script>
{% endmacro %}